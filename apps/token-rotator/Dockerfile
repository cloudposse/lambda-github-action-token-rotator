# This Dockerfile is used to run the token-rotator app locally for testing purposes. It expects that the app has already 
# been built using the Dockerfile.build.
# 
# Example: 
#
# docker build -t token-rotator -f apps/token-rotator/Dockerfile . && \
# docker run \
#   -p 9000:8080 \
#   -e AWS_REGION="us-east-1" \
#   -e GITHUB_APP_ID="111111" \
#   -e GITHUB_INSTALLATION_ID="22222222" \
#   -e GITHUB_ORG="cloudposse" \
#   -e GITHUB_PRIVATE_KEY="LS0uPS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCRBUBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRRE1MNSs5dk1pbkRSdncKSWQ0MGNVc1pJdWFHNU5XOHoxM2lQbWFKSGlhUksxUVBzL2lJK0d1L01GWUVaZVNJbFluVUZ1WTU1WHFKYjhFUQp2U3B5LzNIU3BtQXIyY3VDZlllRWhScTR3cG9aejNRdERqQ3F6VHFybUVialRuWmkrY0hqaGt2Q09tOFdDTWRDCkZLNVBLRjFydEVsVUJ4Z2E3dTllNEVIRFNnM3NMMGhJS0lmc2FyYmExdm0xRjJTYWxNMGxyUzZ4akJvOTloWlMKaTlyYW5OYjg5cG5FcmRVeG9ycCtQQkpvQldJVGp2OFRmV3FpUlNNclFSS0JyUkZBaG42K0RiSTZtYlRwTEhMUgpHbmVvZWpLNWp2NkdZQjZMKzNISVc0ZkhiOWd0TzVRYklsWms3MEN3VzIrS1lXZyt4SFA4d2R3c0ltTldzM1hlCnU1ODdZNUxiQWdNQkFBRUNnZ0VCQUtDRmFDMi85bmJ0NVdMWkhWbFpIOUw1RHdaSmJJYnM5ei9nRXJnRlRnaWUKYVkyV3pQTFJhZE42YW9VMm5YMkxJam5zYnI1aFcvNGtMMEc3bFYybTJKTGtYWUxiekJRZ0g2UGRDRzdyL2o0QQpTN01JRHRhWVZXR0ZhMlZUejlwcnd6UGQ1ajBodHljNWEzelZ5VnROdm5QbjNpWURGYjVHelVSblJRd0VjZ0dVCm1yd2tuZDlIWXpRc0Z1VU01Q2FzUmwwOW1mNG4xNUw3WjJ5dU4zM3FaRXlnUjdOYlFhSzg0UU5KUHVtMS9ESFUKbmpUSG0zditza3V6cFRjMXU2UU1jbFlkTzV0bHYvS2VzK3M2ZUY1RTdSOFl6L0JpVVJ4R1JxQWM5bmh3VmNMUApFN0I5cWw2aERSQzJReUNkbFV6U0hoM2NPSkpBNTAvM2QrVXBOWWtlSEVFQ2dZRUE2ejdWY2FnRVppK0hNVjk4CmdLL1lsV0NKbkdETTI2aUk4dUN5bDJkTEliZzB0Tlg5Y09sRmdzZm54b1JwVmZhSTlSckNxNnpwZTRZVWNkS0YKdkpwYmVZK2xxcllIbHR2STNLcUZoZlRNS21qeERQQ2p0N1gxY0dURXJCdU9QT3VSdkhFeVdtYjUxTGFIN3Q3SQo4Vi9UTWI4VlBiNVN6dWlLaGxaK3pmTUh2dEVDZ1lFQTNqTkxPZkYrcU50VlN1WEhoZ29kb1VuMEx2T1gvaC85CmNGeE9VNDc1ejA5SnpFVHhHWTE4b1oySXI1dHdYMW5PcURXZUV5NUU2cG9rM0tjY0J3bk5EeXBwNDVuQU0ycUYKSWdMdkhub0JqTjhEQTB3cTF2VTY4cTM1T2YzQW1tQldHMGZlRUJCM0Zud1hIa0U5cW5IS3NsTjhSVkVuV1ppUgp2TDBNeHJLVkdlc0NnWUVBbzNyL0NnVWhTWUl1Q1htNkpCUVFCMzhYSXIyQ29BUDNhQklQQ25pV0ZkRFZqL1pHCk1ubHAvUUMvYVk0TFJkb1dRMzlkV2NESVlUZEViZlZIUzFKWno1aXNJSDV2dDc3MVQ2U1JOZzV3OCtnSjNGdysKNmlSaGRNSVNpeWg3S0lyc3RIQlY5YzBxUVZDNEZxQnNOSkhMU3Y3bjNBaXZzMnFYR2RSeU90MXh2SUVDZ1lFQQowZDluQldLNVBLcDJSRmtHZk85ZkR6RzM1d1VFSWU1N1JqNlphTWtaNFJyRjNKK2Rqb0lhSHRpWit5djVGc2JQCnNBZDh1Q2N5eHRnelN3cTRLVm16aXNpSDNZY2lpQzNyYzdXTHY2Q0RpRmc0RTB4RkJtWDRlTEdrUG9jVC9YeFMKdUUvSVNpb1RJWFN4clV6My90NmVFcE5TUkhLamxUZkxKNWIwMDFSb0NtTUNnWUJzTnRsQmI5NEZTY0FkSHBBbQprM1dUblUwSFo5aUpkWS85UWtXUHBpNU52b1pQbmF4NnV5bXpKRlRtcDFDOCtNQXdoTlV0Q0IrVGExWFZ2Z0NMCnp3dWtQQURTT05XWGtiUkdTY1prQkdJQmZtc1FLbCtCQVJzcDJ3MVFhTTlSdGVvcmRxM2N2Wk80N29RK0NIQWYKazViTUdUZ2pXUGxMRlF0K3pCQW83Zmk0MEE9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==" \
#   token-rotator
FROM public.ecr.aws/lambda/nodejs:20

# add app
COPY dist/apps/token-rotator/* ${LAMBDA_TASK_ROOT}

ENV NODE_ENV=production

CMD [ "main.handler" ]